<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Sso on Software Musings</title>
    <link>https://www.marcelbelmont.com/tags/sso/</link>
    <description>Recent content in Sso on Software Musings</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <copyright>&amp;copy; 2017 Jean-Marcel Belmont</copyright>
    <lastBuildDate>Wed, 06 Sep 2017 14:41:25 -0400</lastBuildDate>
    <atom:link href="/tags/sso/" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Single Sign-On concepts explained through Oauth, Saml and Json Web Tokens</title>
      <link>https://www.marcelbelmont.com/post/concepts-in-single-sign-on-using-jwt-and-saml/</link>
      <pubDate>Wed, 06 Sep 2017 14:41:25 -0400</pubDate>
      
      <guid>https://www.marcelbelmont.com/post/concepts-in-single-sign-on-using-jwt-and-saml/</guid>
      <description>

&lt;h1 id=&#34;authentication-authorization-oauth-saml&#34;&gt;Authentication, Authorization, Oauth, SAML&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#basic-authentication-with-http&#34;&gt;Basic Authentication with HTTP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#digest-schemes&#34;&gt;Digest Schemes&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#single-sign-on-with-oauth-and-saml&#34;&gt;Single Sign-On with Oauth and SAML&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#oauth&#34;&gt;Oauth&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#security-assertion-markup-language&#34;&gt;Security Assertion Markup Language&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#repo-details&#34;&gt;Repo Details&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;basic-authentication-with-http&#34;&gt;Basic Authentication with HTTP&lt;/h2&gt;

&lt;blockquote&gt;
&lt;p&gt;&amp;ldquo;HTTP/1.0&amp;rdquo;, includes the specification for a Basic Access
Authentication scheme. This scheme is not considered to be a secure
method of user authentication (unless used in conjunction with some
external secure system such as SSL [5]), as the user name and
password are passed over the network as cleartext.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&#34;https://tools.ietf.org/html/rfc2617&#34; target=&#34;_blank&#34;&gt;Basic Authentication RFC2617&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;If an HTTP receives an anonymous request for a protected resource it can force the use of Basic authentication by rejecting the request with a 401 (Access Denied) status code and setting the WWW-Authenticate response header as shown below:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-HTTP&#34;&gt;HTTP/1.1 401 Access Denied
WWW-Authenticate: Basic realm=&amp;quot;My Server&amp;quot;
Content-Length: 0
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;basic-authentication-the-client-sends-the-user-name-and-password-as-unencrypted-base64-encoded-text&#34;&gt;Basic Authentication - The client sends the user name and password as unencrypted base64 encoded text.&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;Basic Authenthication should only be used with HTTPS, as the password can be easily captured and reused over HTTP.&lt;/strong&gt;&lt;/p&gt;

&lt;h4 id=&#34;example-of-basic-auth-using-curl-with-neither-authorization-header-set-nor-username-and-password-set-in-url&#34;&gt;Example of Basic Auth using CURL with neither Authorization header set nor username and password set in url&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-HTTP&#34;&gt;curl -k -X GET &amp;quot;https://localhost:3000/api/v1/basicAuth&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;returns the header&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-HTTP&#34;&gt;WWW-Authenticate →Basic realm=&amp;quot;need login credendtials&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The HTTP Status Code of &lt;code&gt;401&lt;/code&gt; meaning unauthorized&lt;/p&gt;

&lt;p&gt;Using Basic Auth in url with Curl Command&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-HTTP&#34;&gt;curl -k -X GET &amp;quot;https://rambo:soldier@localhost:3000/api/v1/basicAuth&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;returns following response&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{
  &amp;quot;credentials&amp;quot;: {
    &amp;quot;username&amp;quot;: &amp;quot;rambo&amp;quot;,
    &amp;quot;password&amp;quot;: &amp;quot;soldier&amp;quot;
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h5 id=&#34;providing-the-following-username-and-password-credentials&#34;&gt;Providing the following username and password credentials&lt;/h5&gt;

&lt;p&gt;Username: &lt;code&gt;rambo&lt;/code&gt;
Password: &lt;code&gt;soldier&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Using Chrome Developer Tools JavaScript Console:&lt;/p&gt;

&lt;p&gt;&lt;code&gt;window.btoa(&amp;quot;rambo&amp;quot; + &amp;quot;:&amp;quot; + &amp;quot;soldier&amp;quot;)&lt;/code&gt; returns base64 encoded string &lt;code&gt;cmFtYm86c29sZGllcg==&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Using Node.js Buffer toString Method in node repl&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-node&#34;&gt;new Buffer(&#39;rambo&#39; + &#39;:&#39; + &#39;soldier&#39;).toString(&#39;base64&#39;)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;return base64 encode string &lt;code&gt;cmFtYm86c29sZGllcg==&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Using Basic Auth with Authorization Header set&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-HTTP&#34;&gt;curl -k -X GET -H &amp;quot;Authorization: Basic cmFtYm86c29sZGllcg==&amp;quot; &amp;quot;https://localhost:3000/api/v1/basicAuth&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;returns following response&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{
  &amp;quot;credentials&amp;quot;: {
    &amp;quot;username&amp;quot;: &amp;quot;rambo&amp;quot;,
    &amp;quot;password&amp;quot;: &amp;quot;soldier&amp;quot;
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;In order to parse The Authorization Header in Chrome and return an object&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;atob(&#39;basic cmFtYm86c29sZGllcg==&#39;
  .split(&#39; &#39;)[1])
  .split(&#39;:&#39;)
  .reduce((prev, curr, idx, arr) =&amp;gt;  {
    prev[curr] = curr;
    return prev;
  }, {});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;In order to parse the Authorization Header in Nodejs and return an object&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-node&#34;&gt;const authorization = &#39;basic cmFtYm86c29sZGllcg==&#39;.split(&#39; &#39;);
const parseString = new Buffer(authorization[1], &#39;base64&#39;).toString();
return parseString.split(&#39;:&#39;)
  .reduce((prev, curr, idx, arr) =&amp;gt;  {
    prev[curr] = curr;
    return prev;
  }, {});
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;digest-schemes&#34;&gt;Digest Schemes&lt;/h2&gt;

&lt;blockquote&gt;
&lt;p&gt;the Digest scheme is based on a
simple challenge-response paradigm. The Digest scheme challenges
using a nonce value. A valid response contains a checksum (by
default, the MD5 checksum) of the username, the password, the given
nonce value, the HTTP method, and the requested URI. In this way, the
password is never sent in the clear. Just as with the Basic scheme,
the username and password must be prearranged in some fashion not
addressed by this document.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&#34;https://tools.ietf.org/html/rfc2617&#34; target=&#34;_blank&#34;&gt;Digest Schemes RFC2617&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;The Digest Access Authentication scheme is not intended to be a
complete answer to the need for security in the World Wide Web. This
scheme provides no encryption of message content. The intent is
simply to create an access authentication method that avoids the most
serious flaws of Basic authentication.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&#34;https://tools.ietf.org/html/rfc2617#page-6&#34; target=&#34;_blank&#34;&gt;Digest Access Authentication&lt;/a&gt;&lt;/p&gt;

&lt;h4 id=&#34;digest-authentication&#34;&gt;Digest Authentication&lt;/h4&gt;

&lt;blockquote&gt;
&lt;p&gt;The Digest scheme is based on a simple challenge-response paradigm.
The Digest scheme challenges using a nonce value and might indicate
that username hashing is supported.  A valid response contains an
unkeyed digest of the username, the password, the given nonce value,
the HTTP method, and the requested URI.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Digest access authentication was originally specified by RFC 2069 (An Extension to HTTP: Digest Access Authentication).
RFC 2069 specifies roughly a traditional digest authentication scheme with security maintained by a server-generated noncevalue.
The authentication response is formed as follows (where HA1 and HA2 are names of string variables):&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/MD5&#34; target=&#34;_blank&#34;&gt;MD5 Algorithm&lt;/a&gt;
&lt;strong&gt;MD5 is an algorithm that produces a hash&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;ha1 = md5(username:realm:password)&lt;/code&gt;
&lt;code&gt;ha2 = md5(HTTPMethod:digestURI)&lt;/code&gt;
&lt;code&gt;response = md5(ha1:nonce:ha2)&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;function md5({ str, encoding = &#39;hex&#39; }) {
  return crypto
    .createHash(&#39;md5&#39;)
    .update(str)
    .digest(encoding);
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;A custom md5 function that uses &lt;code&gt;nodejs&lt;/code&gt; crypto library.&lt;/p&gt;

&lt;p&gt;Test usage for md5 to compute &lt;code&gt;ha1&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;test(&#39;mdf5 should compute challenge when given ha2, nonce, cnonce, and qop&#39;, assert =&amp;gt; {
  const md5 = require(&#39;../../utils/md5&#39;).md5;
  const ha2 = md5({
    str: &#39;GET:/api/v1/digestScheme&#39;
  });
  const actual = md5({
    str: `${ha2}:${process.env.NONCE}:${process.env.NONCE}:auth`
  });
  const expected = &#39;adc91a91ffaa68815d5a5d8e4ed8d9e9&#39;;
  assert.is(actual, expected, `should return ${expected}`);
});
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;the-www-authenticate-response-header-field&#34;&gt;The WWW-Authenticate Response Header Field&lt;/h2&gt;

&lt;p&gt;Set HTTP header like so&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;res.setHeader(
  &#39;WWW-Authenticate&#39;,
  `Digest realm=&amp;quot;https://localhost:3000/api/v1/digestScheme&amp;quot;,
  qop=&amp;quot;auth, auth-int&amp;quot;, algorithm=MD5,
  nonce=&amp;quot;${process.env.NONCE}&amp;quot;,
  opaque=&amp;quot;${process.env.OPAQUE}&amp;quot;`
);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Server Challenge computed as follows&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;function serverResponse({ ha2, nonce, cnonce, qop }) {
  return md5({
    str: `${ha2}:${nonce}:${cnonce}:${qop}`
  });
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Checking client response with server response and if they match return authenticated property&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;if (clientChallenge !== serverChallenge) {
    res.setHeader(
      &#39;WWW-Authenticate&#39;,
      `Digest realm=&amp;quot;https://localhost:3000/api/v1/digestScheme&amp;quot;,
      qop=&amp;quot;auth, auth-int&amp;quot;, algorithm=MD5,
      nonce=&amp;quot;${process.env.NONCE}&amp;quot;,
      opaque=&amp;quot;${process.env.OPAQUE}&amp;quot;`
    );
    res.send(responseCodes[&#39;unauthorized&#39;]);
} else {
  res.send(responseCodes[&#39;ok&#39;], {
    authenticated: true
  });
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;single-sign-on-with-oauth-and-saml&#34;&gt;Single Sign-On with Oauth and SAML&lt;/h2&gt;

&lt;h3 id=&#34;sso&#34;&gt;SSO&lt;/h3&gt;

&lt;p&gt;SSO (Single Sign On) occurs when a user logs in to one Client and is then signed in to other Clients automatically, regardless of the platform, technology, or domain the user is using.&lt;/p&gt;

&lt;p&gt;Single sign-on (SSO) is a session and user authentication service that permits a user to use one set of login credentials (e.g., name and password) to access multiple applications.
The service authenticates the end user for all the applications the user has been given rights to and eliminates further prompts when the user switches applications during the same session.&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://www.sitepoint.com/single-sign-on-explained/&#34; target=&#34;_blank&#34;&gt;SSO&lt;/a&gt;
&lt;strong&gt;A good example of the use of SSO is in Google’s services. You need only be signed in to one primary Google account to access different services like YouTube, Gmail, Google+, Google Analytics, and more.&lt;/strong&gt;&lt;/p&gt;

&lt;h2 id=&#34;oauth&#34;&gt;Oauth&lt;/h2&gt;

&lt;blockquote&gt;
&lt;p&gt;OAuth is an open standard for authorization, commonly used as a way for Internet users to authorize websites or applications to access their information on other websites but without giving them the passwords.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&#34;rfc-6749-oauth-2-0-authorization-framework&#34;&gt;RFC 6749 OAuth 2.0 Authorization Framework&lt;/h3&gt;

&lt;p&gt;&lt;a href=&#34;https://tools.ietf.org/html/rfc6749&#34; target=&#34;_blank&#34;&gt;OAuth&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&#34;roles&#34;&gt;Roles&lt;/h3&gt;

&lt;ol&gt;
&lt;li&gt;The Third-Party Application: &amp;ldquo;Client&amp;rdquo;

&lt;ol&gt;
&lt;li&gt;The client is the application that is attempting to get access to the user&amp;rsquo;s account. It needs to get permission from the user before it can do so.&lt;/li&gt;
&lt;/ol&gt;&lt;/li&gt;
&lt;li&gt;The API: &amp;ldquo;Resource Server&amp;rdquo;

&lt;ol&gt;
&lt;li&gt;The resource server is the API server used to access the user&amp;rsquo;s information.&lt;/li&gt;
&lt;/ol&gt;&lt;/li&gt;
&lt;li&gt;The Authorization Server

&lt;ol&gt;
&lt;li&gt;This is the server that presents the interface where the user approves or denies the request. In smaller implementations, this may be the same server as the API server, but larger scale deployments will often build this as a separate component.&lt;/li&gt;
&lt;/ol&gt;&lt;/li&gt;
&lt;li&gt;The User: &amp;ldquo;Resource Owner&amp;rdquo;

&lt;ol&gt;
&lt;li&gt;The resource owner is the person who is giving access to some portion of their account.&lt;/li&gt;
&lt;/ol&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&#34;creating-an-application-for-oauth&#34;&gt;Creating an application for OAuth&lt;/h3&gt;

&lt;p&gt;When registering a new app, you usually register basic information such as application name, website, a logo, etc.
In addition, you must register a redirect URI to be used for redirecting users to for web server, browser-based, or mobile apps.&lt;/p&gt;

&lt;h4 id=&#34;redirect-uris&#34;&gt;Redirect URIs&lt;/h4&gt;

&lt;p&gt;Any HTTP redirect URIs must be protected with TLS security, so the service will only redirect to URIs beginning with &amp;ldquo;https&amp;rdquo;.
This prevents tokens from being intercepted during the authorization process.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Remember that HTTP is a clear text protocol&lt;/em&gt;
&lt;em&gt;Someone can easily sniff packets with tools like Wireshark and see passwords, etc.&lt;/em&gt;&lt;/p&gt;

&lt;h4 id=&#34;client-id-and-secret&#34;&gt;Client ID and Secret&lt;/h4&gt;

&lt;p&gt;Upon registering your app, you will receive a client id and secret&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;The client ID is considered public information, and is used to build login URLs, or included in Javascript source code on a page.&lt;/li&gt;
&lt;li&gt;The client secret must be kept confidential.

&lt;ol&gt;
&lt;li&gt;If a deployed app cannot keep the secret confidential, such as single-page Javascript apps or native apps, then the secret is not used, and ideally the service shouldn&amp;rsquo;t issue a secret to these types of apps in the first place.&lt;/li&gt;
&lt;/ol&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&#34;authorization&#34;&gt;Authorization&lt;/h3&gt;

&lt;p&gt;OAuth 2 provides several &amp;ldquo;grant types&amp;rdquo; for different use cases. The grant types defined are:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Authorization Code for apps running on a web server, browser-based and mobile apps.&lt;/li&gt;
&lt;li&gt;Password for logging in with a username and password&lt;/li&gt;
&lt;li&gt;Client credentials for application access&lt;/li&gt;
&lt;li&gt;Implicit was previously recommended for clients without a secret, but has been superceded by using the Authorization Code grant with no secret.&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&#34;token-exchange&#34;&gt;Token Exchange&lt;/h3&gt;

&lt;p&gt;Client Request&lt;/p&gt;

&lt;p&gt;&lt;code&gt;https://oauth2server.com/auth?response_type=code&amp;amp;client_id=CLIENT_ID&amp;amp;redirect_uri=REDIRECT_URI&amp;amp;scope=photos&amp;amp;state=1234zyx&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-http&#34;&gt;POST https://api.oauth2server.com/token
  grant_type=authorization_code
  &amp;amp;code=AUTH_CODE_HERE
  &amp;amp;redirect_uri=REDIRECT_URI
  &amp;amp;client_id=CLIENT_ID
  &amp;amp;client_secret=CLIENT_SECRET
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;em&gt;Remember the ampersand (&amp;amp;) is a query string separator which are appended to urls&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Break down of the query&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;code&gt;grant_type=authorization_code&lt;/code&gt; - The grant type for this flow is authorization_code&lt;/li&gt;
&lt;li&gt;&lt;code&gt;code=AUTH_CODE_HERE&lt;/code&gt; - This is the code you received in the query string&lt;/li&gt;
&lt;li&gt;&lt;code&gt;redirect_uri=REDIRECT_URI&lt;/code&gt; - Must be identical to the redirect URI provided in the original link&lt;/li&gt;
&lt;li&gt;&lt;code&gt;client_id=CLIENT_ID&lt;/code&gt; - The client ID you received when you first created the application&lt;/li&gt;
&lt;li&gt;&lt;code&gt;client_secret=CLIENT_SECRET&lt;/code&gt; - Since this request is made from server-side code, the secret is included&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Server responds with this possible 200 response&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{
  &amp;quot;access_token&amp;quot;: &amp;quot;RsT5OjbzRn430zqMLgV3Ia&amp;quot;,
  &amp;quot;expires_in&amp;quot;: 3600
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Or this possible 500 level HTTP Error response&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{
  &amp;quot;error&amp;quot;: &amp;quot;invalid_request&amp;quot;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;single-page-apps&#34;&gt;Single-Page Apps&lt;/h4&gt;

&lt;p&gt;GET request from client &lt;code&gt;https://oauth2server.com/auth?response_type=code&amp;amp;client_id=CLIENT_ID&amp;amp;redirect_uri=REDIRECT_URI&amp;amp;scope=photos&amp;amp;state=1234zyx&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Newer query string parameters&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;scope - One or more scope values indicating which parts of the user&amp;rsquo;s account you wish to access&lt;/li&gt;
&lt;li&gt;state - A random string generated by your application, which you&amp;rsquo;ll verify later&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&#34;other-grant-types&#34;&gt;Other Grant Types&lt;/h2&gt;

&lt;p&gt;OAuth 2 also provides a &amp;ldquo;password&amp;rdquo; grant type which can be used to exchange a username and password for an access token directly.
Since this obviously requires the application to collect the user&amp;rsquo;s password, it must only be used by apps created by the service itself.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-http&#34;&gt;POST https://api.oauth2server.com/token
  grant_type=password&amp;amp;
  username=USERNAME&amp;amp;
  password=PASSWORD&amp;amp;
  client_id=CLIENT_ID
&lt;/code&gt;&lt;/pre&gt;

&lt;ol&gt;
&lt;li&gt;&lt;code&gt;grant_type=password&lt;/code&gt; - The grant type for this flow is password&lt;/li&gt;
&lt;li&gt;&lt;code&gt;username=USERNAME&lt;/code&gt; - The user&amp;rsquo;s username as collected by the application&lt;/li&gt;
&lt;li&gt;&lt;code&gt;password=PASSWORD&lt;/code&gt; - The user&amp;rsquo;s password as collected by the application&lt;/li&gt;
&lt;li&gt;&lt;code&gt;client_id=CLIENT_ID&lt;/code&gt; - The client ID you received when you first created the application&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Sample Curl Request with bearer token&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;curl -H &amp;quot;Authorization: Bearer RsT5OjbzRn430zqMLgV3Ia&amp;quot; \
https://api.oauth2server.com/1/me
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;security-assertion-markup-language&#34;&gt;Security Assertion Markup Language&lt;/h2&gt;

&lt;blockquote&gt;
&lt;p&gt;Security Assertion Markup Language (SAML, pronounced sam-el) is an XML-based,
open-standard data format for exchanging authentication and authorization data between parties,
in particular, between an identity provider and a service provider.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/Security_Assertion_Markup_Language&#34; target=&#34;_blank&#34;&gt;SAML&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;SAML is an XML-based framework that allows identity and security information to be shared across security domains.&lt;/p&gt;

&lt;p&gt;The Assertion, an XML security token, is a fundamental construct of SAML that is often adopted for use in other protocols and specifications.&lt;/p&gt;

&lt;h4 id=&#34;saml&#34;&gt;SAML&lt;/h4&gt;

&lt;p&gt;&lt;a href=&#34;https://tools.ietf.org/html/rfc7522&#34; target=&#34;_blank&#34;&gt;RFC 7522&lt;/a&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;SAML is a standard for logging users into applications based on their sessions in another context.&lt;/li&gt;

&lt;li&gt;&lt;p&gt;This single sign-on (SSO) login standard has significant advantages over logging in using a username/password:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;No need to type in credentials&lt;/li&gt;
&lt;li&gt;No need to remember and renew passwords&lt;/li&gt;
&lt;li&gt;No weak passwords&lt;/li&gt;
&lt;/ol&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;SAML SSO works by transferring the user’s identity from one place (the identity provider) to another (the service provider)&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;This is done through an exchange of digitally signed XML documents.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Here is an example that contains contains an authorization request.
An Authorization Request is sent by the Service Provider to the Identity Provider.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;samlp:AuthnRequest xmlns:samlp=&amp;quot;urn:oasis:names:tc:SAML:2.0:protocol&amp;quot; xmlns:saml=&amp;quot;urn:oasis:names:tc:SAML:2.0:assertion&amp;quot; ID=&amp;quot;pfx41d8ef22-e612-8c50-9960-1b16f15741b3&amp;quot; Version=&amp;quot;2.0&amp;quot; ProviderName=&amp;quot;SP test&amp;quot; IssueInstant=&amp;quot;2014-07-16T23:52:45Z&amp;quot; Destination=&amp;quot;http://idp.example.com/SSOService.php&amp;quot; ProtocolBinding=&amp;quot;urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST&amp;quot; AssertionConsumerServiceURL=&amp;quot;http://sp.example.com/demo1/index.php?acs&amp;quot;&amp;gt;
  &amp;lt;saml:Issuer&amp;gt;http://sp.example.com/demo1/metadata.php&amp;lt;/saml:Issuer&amp;gt;
  &amp;lt;ds:Signature xmlns:ds=&amp;quot;http://www.w3.org/2000/09/xmldsig#&amp;quot;&amp;gt;
    &amp;lt;ds:SignedInfo&amp;gt;
      &amp;lt;ds:CanonicalizationMethod Algorithm=&amp;quot;http://www.w3.org/2001/10/xml-exc-c14n#&amp;quot;/&amp;gt;
      &amp;lt;ds:SignatureMethod Algorithm=&amp;quot;http://www.w3.org/2000/09/xmldsig#rsa-sha1&amp;quot;/&amp;gt;
      &amp;lt;ds:Reference URI=&amp;quot;#pfx41d8ef22-e612-8c50-9960-1b16f15741b3&amp;quot;&amp;gt;
        &amp;lt;ds:Transforms&amp;gt;
          &amp;lt;ds:Transform Algorithm=&amp;quot;http://www.w3.org/2000/09/xmldsig#enveloped-signature&amp;quot;/&amp;gt;
          &amp;lt;ds:Transform Algorithm=&amp;quot;http://www.w3.org/2001/10/xml-exc-c14n#&amp;quot;/&amp;gt;
        &amp;lt;/ds:Transforms&amp;gt;
        &amp;lt;ds:DigestMethod Algorithm=&amp;quot;http://www.w3.org/2000/09/xmldsig#sha1&amp;quot;/&amp;gt;
        &amp;lt;ds:DigestValue&amp;gt;yJN6cXUwQxTmMEsPesBP2NkqYFI=&amp;lt;/ds:DigestValue&amp;gt;
      &amp;lt;/ds:Reference&amp;gt;
    &amp;lt;/ds:SignedInfo&amp;gt;
    &amp;lt;ds:SignatureValue&amp;gt;g5eM9yPnKsmmE/Kh2qS7nfK8HoF6yHrAdNQxh70kh8pRI4KaNbYNOL9sF8F57Yd+jO6iNga8nnbwhbATKGXIZOJJSugXGAMRyZsj/rqngwTJk5KmujbqouR1SLFsbo7Iuwze933EgefBbAE4JRI7V2aD9YgmB3socPqAi2Qf97E=&amp;lt;/ds:SignatureValue&amp;gt;
    &amp;lt;ds:KeyInfo&amp;gt;
      &amp;lt;ds:X509Data&amp;gt;
        &amp;lt;ds:X509Certificate&amp;gt;MIICajCCAdOgAwIBAgIBADANBgkqhkiG9w0BAQQFADBSMQswCQYDVQQGEwJ1czETMBEGA1UECAwKQ2FsaWZvcm5pYTEVMBMGA1UECgwMT25lbG9naW4gSW5jMRcwFQYDVQQDDA5zcC5leGFtcGxlLmNvbTAeFw0xNDA3MTcwMDI5MjdaFw0xNTA3MTcwMDI5MjdaMFIxCzAJBgNVBAYTAnVzMRMwEQYDVQQIDApDYWxpZm9ybmlhMRUwEwYDVQQKDAxPbmVsb2dpbiBJbmMxFzAVBgNVBAMMDnNwLmV4YW1wbGUuY29tMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC7vU/6R/OBA6BKsZH4L2bIQ2cqBO7/aMfPjUPJPSn59d/f0aRqSC58YYrPuQODydUABiCknOn9yV0fEYm4bNvfjroTEd8bDlqo5oAXAUAI8XHPppJNz7pxbhZW0u35q45PJzGM9nCv9bglDQYJLby1ZUdHsSiDIpMbGgf/ZrxqawIDAQABo1AwTjAdBgNVHQ4EFgQU3s2NEpYx7wH6bq7xJFKa46jBDf4wHwYDVR0jBBgwFoAU3s2NEpYx7wH6bq7xJFKa46jBDf4wDAYDVR0TBAUwAwEB/zANBgkqhkiG9w0BAQQFAAOBgQCPsNO2FG+zmk5miXEswAs30E14rBJpe/64FBpM1rPzOleexvMgZlr0/smF3P5TWb7H8Fy5kEiByxMjaQmml/nQx6qgVVzdhaTANpIE1ywEzVJlhdvw4hmRuEKYqTaFMLez0sRL79LUeDxPWw7Mj9FkpRYT+kAGiFomHop1nErV6Q==&amp;lt;/ds:X509Certificate&amp;gt;
      &amp;lt;/ds:X509Data&amp;gt;
    &amp;lt;/ds:KeyInfo&amp;gt;
  &amp;lt;/ds:Signature&amp;gt;
  &amp;lt;samlp:NameIDPolicy Format=&amp;quot;urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress&amp;quot; AllowCreate=&amp;quot;true&amp;quot;/&amp;gt;
  &amp;lt;samlp:RequestedAuthnContext Comparison=&amp;quot;exact&amp;quot;&amp;gt;
    &amp;lt;saml:AuthnContextClassRef&amp;gt;urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport&amp;lt;/saml:AuthnContextClassRef&amp;gt;
  &amp;lt;/samlp:RequestedAuthnContext&amp;gt;
&amp;lt;/samlp:AuthnRequest&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Response&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-xml&#34;&gt;&amp;lt;samlp:Response xmlns:samlp=&amp;quot;urn:oasis:names:tc:SAML:2.0:protocol&amp;quot; xmlns:saml=&amp;quot;urn:oasis:names:tc:SAML:2.0:assertion&amp;quot; ID=&amp;quot;_8e8dc5f69a98cc4c1ff3427e5ce34606fd672f91e6&amp;quot; Version=&amp;quot;2.0&amp;quot; IssueInstant=&amp;quot;2014-07-17T01:01:48Z&amp;quot; Destination=&amp;quot;http://sp.example.com/demo1/index.php?acs&amp;quot; InResponseTo=&amp;quot;ONELOGIN_4fee3b046395c4e751011e97f8900b5273d56685&amp;quot;&amp;gt;
  &amp;lt;saml:Issuer&amp;gt;http://idp.example.com/metadata.php&amp;lt;/saml:Issuer&amp;gt;
  &amp;lt;samlp:Status&amp;gt;
    &amp;lt;samlp:StatusCode Value=&amp;quot;urn:oasis:names:tc:SAML:2.0:status:Success&amp;quot;/&amp;gt;
  &amp;lt;/samlp:Status&amp;gt;
  &amp;lt;saml:Assertion xmlns:xsi=&amp;quot;http://www.w3.org/2001/XMLSchema-instance&amp;quot; xmlns:xs=&amp;quot;http://www.w3.org/2001/XMLSchema&amp;quot; ID=&amp;quot;_d71a3a8e9fcc45c9e9d248ef7049393fc8f04e5f75&amp;quot; Version=&amp;quot;2.0&amp;quot; IssueInstant=&amp;quot;2014-07-17T01:01:48Z&amp;quot;&amp;gt;
    &amp;lt;saml:Issuer&amp;gt;http://idp.example.com/metadata.php&amp;lt;/saml:Issuer&amp;gt;
    &amp;lt;saml:Subject&amp;gt;
      &amp;lt;saml:NameID SPNameQualifier=&amp;quot;http://sp.example.com/demo1/metadata.php&amp;quot; Format=&amp;quot;urn:oasis:names:tc:SAML:2.0:nameid-format:transient&amp;quot;&amp;gt;_ce3d2948b4cf20146dee0a0b3dd6f69b6cf86f62d7&amp;lt;/saml:NameID&amp;gt;
      &amp;lt;saml:SubjectConfirmation Method=&amp;quot;urn:oasis:names:tc:SAML:2.0:cm:bearer&amp;quot;&amp;gt;
        &amp;lt;saml:SubjectConfirmationData NotOnOrAfter=&amp;quot;2024-01-18T06:21:48Z&amp;quot; Recipient=&amp;quot;http://sp.example.com/demo1/index.php?acs&amp;quot; InResponseTo=&amp;quot;ONELOGIN_4fee3b046395c4e751011e97f8900b5273d56685&amp;quot;/&amp;gt;
      &amp;lt;/saml:SubjectConfirmation&amp;gt;
    &amp;lt;/saml:Subject&amp;gt;
    &amp;lt;saml:Conditions NotBefore=&amp;quot;2014-07-17T01:01:18Z&amp;quot; NotOnOrAfter=&amp;quot;2024-01-18T06:21:48Z&amp;quot;&amp;gt;
      &amp;lt;saml:AudienceRestriction&amp;gt;
        &amp;lt;saml:Audience&amp;gt;http://sp.example.com/demo1/metadata.php&amp;lt;/saml:Audience&amp;gt;
      &amp;lt;/saml:AudienceRestriction&amp;gt;
    &amp;lt;/saml:Conditions&amp;gt;
    &amp;lt;saml:AuthnStatement AuthnInstant=&amp;quot;2014-07-17T01:01:48Z&amp;quot; SessionNotOnOrAfter=&amp;quot;2024-07-17T09:01:48Z&amp;quot; SessionIndex=&amp;quot;_be9967abd904ddcae3c0eb4189adbe3f71e327cf93&amp;quot;&amp;gt;
      &amp;lt;saml:AuthnContext&amp;gt;
        &amp;lt;saml:AuthnContextClassRef&amp;gt;urn:oasis:names:tc:SAML:2.0:ac:classes:Password&amp;lt;/saml:AuthnContextClassRef&amp;gt;
      &amp;lt;/saml:AuthnContext&amp;gt;
    &amp;lt;/saml:AuthnStatement&amp;gt;
    &amp;lt;saml:AttributeStatement&amp;gt;
      &amp;lt;saml:Attribute Name=&amp;quot;uid&amp;quot; NameFormat=&amp;quot;urn:oasis:names:tc:SAML:2.0:attrname-format:basic&amp;quot;&amp;gt;
        &amp;lt;saml:AttributeValue xsi:type=&amp;quot;xs:string&amp;quot;&amp;gt;test&amp;lt;/saml:AttributeValue&amp;gt;
      &amp;lt;/saml:Attribute&amp;gt;
      &amp;lt;saml:Attribute Name=&amp;quot;mail&amp;quot; NameFormat=&amp;quot;urn:oasis:names:tc:SAML:2.0:attrname-format:basic&amp;quot;&amp;gt;
        &amp;lt;saml:AttributeValue xsi:type=&amp;quot;xs:string&amp;quot;&amp;gt;test@example.com&amp;lt;/saml:AttributeValue&amp;gt;
      &amp;lt;/saml:Attribute&amp;gt;
      &amp;lt;saml:Attribute Name=&amp;quot;eduPersonAffiliation&amp;quot; NameFormat=&amp;quot;urn:oasis:names:tc:SAML:2.0:attrname-format:basic&amp;quot;&amp;gt;
        &amp;lt;saml:AttributeValue xsi:type=&amp;quot;xs:string&amp;quot;&amp;gt;users&amp;lt;/saml:AttributeValue&amp;gt;
        &amp;lt;saml:AttributeValue xsi:type=&amp;quot;xs:string&amp;quot;&amp;gt;examplerole1&amp;lt;/saml:AttributeValue&amp;gt;
      &amp;lt;/saml:Attribute&amp;gt;
    &amp;lt;/saml:AttributeStatement&amp;gt;
  &amp;lt;/saml:Assertion&amp;gt;
&amp;lt;/samlp:Response&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;There are some libraries that passport-saml uses such as xmlbuilder xmldom, xml-crypto and more to work with saml requests and responses&lt;/p&gt;

&lt;p&gt;Essentially the HTTP Request will be like This with a bearer token&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-http&#34;&gt;GET https://localhost:3000/api/v1/saml

Authorization: &#39;Bearer {ACCESS_TOKEN}&#39;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This is a curl request with a content-type header of application/x-www-form-urlencoded and a grant type in Oauth languagee with client credentials&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;curl https://localhost:3000/api/v1/saml
  -d &#39;grant_type=client_credentials&amp;amp;client_id=TestClient&amp;amp;client_secret=TestSecret&#39;
  -H &#39;Content-Type: application/x-www-form-urlencoded&#39;
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;json-web-token-jwt&#34;&gt;JSON Web Token (JWT)&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;https://tools.ietf.org/html/rfc7519&#34; target=&#34;_blank&#34;&gt;JWT&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Read the docs at &lt;a href=&#34;https://jwt.io/introduction/&#34; target=&#34;_blank&#34;&gt;JWT&lt;/a&gt; there is a great explanation of JWTs&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Essentially with JWTs there is 3 parts:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Header&lt;/li&gt;
&lt;li&gt;Body&lt;/li&gt;
&lt;li&gt;Signature&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Check out &lt;a href=&#34;https://jwt.io/#debugger&#34; target=&#34;_blank&#34;&gt;JWT Debugger&lt;/a&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;I wrote some small utilities in the &lt;a href=&#34;https://github.com/jbelmont/sso-with-oauth-and-saml&#34; target=&#34;_blank&#34;&gt;SSO with oAuth and Saml Repo&lt;/a&gt; in the utils folder&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;&#39;use strict&#39;;

function base64(str) {
  return new Buffer(JSON.stringify(str))
    .toString(&#39;base64&#39;)
    .replace(/=/g,&#39;&#39;)
    .replace(/\+/g,&#39;-&#39;)
    .replace(/\//g,&#39;_&#39;);
}

function b64(str) {
  return new Buffer(JSON.stringify(str))
    .toString(&#39;base64&#39;);
}

exports.base64 = base64;
exports.b64 = b64;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This small function does Base 64 encoding&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;&#39;use strict&#39;;

function decodeUnsignedJWT(jwt) {
  const [
    headerB64,
    payloadB64
   ] = jwt.split(&#39;.&#39;);
  const headerStr = new Buffer(headerB64, &#39;base64&#39;).toString();
  const payloadStr = new Buffer(payloadB64, &#39;base64&#39;).toString();
  return {
    header: JSON.parse(headerStr),
    payload: JSON.parse(payloadStr)
  };
}

function decodeBasicAuth(str) {
  const usernameAndPassword = str.split(&#39; &#39;)[1];
  const parseString = new Buffer(usernameAndPassword, &#39;base64&#39;).toString();
  const [
    username,
    password
  ] = parseString.split(&#39;:&#39;);
  return {
    username,
    password
  };
}

exports.decodeUnsignedJWT = decodeUnsignedJWT;
exports.decodeBasicAuth = decodeBasicAuth;
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;decodeUnsignedJWT&lt;/code&gt; can split a jwt by header and payload&lt;/li&gt;
&lt;li&gt;&lt;code&gt;decodeBasicAuth&lt;/code&gt; can split a Basic Authorization request&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;repo-details&#34;&gt;Repo Details&lt;/h2&gt;

&lt;p&gt;Please star &lt;a href=&#34;https://github.com/jbelmont/sso-with-oauth-and-saml&#34; target=&#34;_blank&#34;&gt;SSO with oauth and saml&lt;/a&gt; and follow me at &lt;a href=&#34;https://github.com/jbelmont&#34; target=&#34;_blank&#34;&gt;jbelmont&lt;/a&gt; on Github&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>
