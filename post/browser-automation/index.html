<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme" content="hugo-academic">
  <meta name="generator" content="Hugo 0.58.0-DEV" />
  <meta name="author" content="Jean-Marcel Belmont">
  <meta name="description" content="Senior Software Engineer">

  
  
  
    
  
  
    
    
    <link rel="stylesheet" href="/css/highlight.min.css">
    
  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha512-6MXa8B6uaO18Hid6blRMetEIoPqHf7Ux1tnyIQdpt9qI5OACx7C+O3IVTr98vwGnlcg0LOLa02i9Y1HpVhlfiw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.0/css/academicons.min.css" integrity="sha512-GGGNUPDhnG8LEAEDsjqYIQns+Gu8RBs4j5XGlxl7UfRaZBhCCm5jenJkeJL8uPuOXGqgl8/H1gjlWQDRjd3cUQ==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha512-SfTiTlX6kk+qitfevl/7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+/Sw==" crossorigin="anonymous">
  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather%7CRoboto+Mono">
  <link rel="stylesheet" href="/css/hugo-academic.css">
  

  
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-118360144-1', 'auto');
      ga('require', 'eventTracker');
      ga('require', 'outboundLinkTracker');
      ga('require', 'urlChangeTracker');
      ga('send', 'pageview');
    </script>
    <script async src="//www.google-analytics.com/analytics.js"></script>
    
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/autotrack/2.4.1/autotrack.js" integrity="sha512-HUmooslVKj4m6OBu0OgzjXXr+QuFYy/k7eLI5jdeEy/F4RSgMn6XRWRGkFi5IFaFgy7uFTkegp3Z0XnJf3Jq+g==" crossorigin="anonymous"></script>
    
  

  <link rel="alternate" href="https://www.marcelbelmont.com/index.xml" type="application/rss+xml" title="Software Musings">
  <link rel="feed" href="https://www.marcelbelmont.com/index.xml" type="application/rss+xml" title="Software Musings">

  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/apple-touch-icon.png">

  <link rel="canonical" href="https://www.marcelbelmont.com/post/browser-automation/">

  

  <title>Browser Automation | Software Musings</title>

</head>
<body id="top" data-spy="scroll" data-target="#navbar-main" data-offset="71">

<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">Software Musings</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav navbar-right">
        

        

        <li class="nav-item">
          <a href="/#about">
            
            <span>Home</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/#publications">
            
            <span>Publications</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/#talks">
            
            <span>Talks</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/#posts">
            
            <span>Posts</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/#projects">
            
            <span>Projects</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/#contact">
            
            <span>Contact</span>
          </a>
        </li>

        
        

        
      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  


  <div class="article-container">
    <h1 itemprop="name">Browser Automation</h1>
    

<div class="article-metadata">

  <span class="article-date">
    <time datetime="2018-06-24 12:00:00 &#43;0000 UTC" itemprop="datePublished">
      Sun, Jun 24, 2018
    </time>
  </span>

  

  
  
  
  <span class="article-tags">
    <i class="fa fa-tags"></i>
    
    <a href="/tags/testing">testing</a
    >, 
    
    <a href="/tags/e2e">e2e</a
    >, 
    
    <a href="/tags/automation">automation</a
    >
    
  </span>
  
  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fwww.marcelbelmont.com%2fpost%2fbrowser-automation%2f"
         target="_blank">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=Browser%20Automation&amp;url=https%3a%2f%2fwww.marcelbelmont.com%2fpost%2fbrowser-automation%2f"
         target="_blank">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fwww.marcelbelmont.com%2fpost%2fbrowser-automation%2f&amp;title=Browser%20Automation"
         target="_blank">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=https%3a%2f%2fwww.marcelbelmont.com%2fpost%2fbrowser-automation%2f&amp;title=Browser%20Automation"
         target="_blank">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=Browser%20Automation&amp;body=https%3a%2f%2fwww.marcelbelmont.com%2fpost%2fbrowser-automation%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>

    <div class="article-style" itemprop="articleBody">
      

<p>In this blog post we will look at cypress.io and puppeteer as viable replacements to Selenium WebDriver. Selenium WebDriver is still a good option for writing End to End Tests but over the years some newer libraries have spawned that use Chrome DevTools Protocol or to be more specific use Chrome to UI Tests.</p>

<h2 id="selenium-webdriver">Selenium WebDriver</h2>

<p>Selenium WebDriver has been in use for a long while and Selenium WebDriver drives the browser by utilizing an Object Oriented API that is built in Java. Selenium has client apis in Java, C#, Ruby, Python, and JavaScript.</p>

<h4 id="some-drawbacks-to-selenium">Some Drawbacks to Selenium</h4>

<ul>
<li>End to End tests written in Selenium tend to be brittle</li>
<li>Setup can be very complicated</li>
<li>Tests can be really slow as each tests spins up a browser instance.</li>
</ul>

<h2 id="options-to-selenium">Options to Selenium</h2>

<p>There are other options instead of Selenium now and in this blog post we will examine <a href="https://pptr.dev/#?product=Puppeteer&amp;version=v1.5.0&amp;show=api-overview" target="_blank">Puppeteer</a> and <a href="https://docs.cypress.io/guides/overview/why-cypress.html" target="_blank">Cypress.io</a> in detail.</p>

<h2 id="puppeteer">Puppeteer</h2>

<p>Puppeteer is a Node library which provides a high-level API to control Chromium or Chrome over the DevTools Protocol. Puppeteer is relatively new as it was released in 2017 as an open source project by a Googler. Puppeteer is a good option to replace <a href="http://phantomjs.org/" target="_blank">Phantomjs</a> which has been suspended from further development.</p>

<h4 id="advantages-of-puppeteer">Advantages of Puppeteer</h4>

<ul>
<li><p>Puppeteer has support for parallelization for running tests in a CI Build</p></li>

<li><p>Spawn multiple browser sessions to help simulate load that a particular service may encounter with multiple clients</p></li>

<li><p>Record snapshots of tests while they run</p></li>
</ul>

<h4 id="setup-puppeteer">Setup Puppeteer</h4>

<p>Installing <a href="https://pptr.dev/" target="_blank">Puppeteer</a> is easy as you can just use npm to install it.</p>

<p><code>npm install --save-dev puppeteer</code></p>

<p>After you have installed puppeteer onto your project the next thing to do is to require puppeteer and to use the puppeteer api to launch a Chrome browser and run your tests.</p>

<h4 id="puppeteer-usage-requirements">Puppeteer Usage Requirements</h4>

<p>Puppeteer can work with Node v6.4.0 or greater but most of the examples in Puppeteer use async and await which is only supported in Node v7.6.0 or greater. So consider adding this to your package.json.</p>

<pre><code class="language-json">&quot;engines&quot;: {
  &quot;node&quot;: &quot;&gt;=7.6.0&quot;
}
</code></pre>

<p><em>This will ensure that only node version 7.6.0 or greater is used</em></p>

<h4 id="puppeteer-example">Puppeteer Example</h4>

<pre><code class="language-js">const puppeteer = require('puppeteer');

(async () =&gt; {
  const browser = await puppeteer.launch();
  const page = await browser.newPage();
  await page.goto('https://marcelbelmont.com');
  await page.screenshot({path: 'blog.png'});

  await browser.close();
})();
</code></pre>

<p>Notice that in the code snippet above we are using async and await in node.js. Take note that async and await are a way to deal with asynchronous action in JavaScript. It is a nicer way to work with asynchronous code over callbacks and promises.</p>

<h4 id="adding-a-web-scraping-test-with-jest">Adding a Web Scraping Test with Jest</h4>

<p>We will be writing a test with the <a href="https://facebook.github.io/jest/" target="_blank">Jest Testing Library</a> by Facebook and using Puppeteer.</p>

<p>In order to install jest run <code>npm install --save-dev jest</code></p>

<p>Jest has mocha like syntax and can be used with many different types of FrontEnd Libraries.</p>

<p>For the purposes of this blog post we will simply be using to write node.js code.</p>

<h6 id="code-snippet-with-blog-test">Code Snippet with Blog Test</h6>

<pre><code class="language-js">&quot;use strict&quot;;

const puppeteer = require(&quot;puppeteer&quot;);

let page;
let browser;
const webpage = &quot;https://github.com/GoogleChrome/puppeteer&quot;;
const width = 1440;
const height = 900;
const myBlog = &quot;blog.png&quot;

describe(&quot;Scrape the Puppeteer github repository&quot;, () =&gt; {

  beforeAll(async () =&gt; {
    browser = await puppeteer.launch({
      headless: true,
      args: [&quot;--no-sandbox&quot;, &quot;--disable-setuid-sandbox&quot;]
    });
    page = await browser.newPage();
    await page.setViewport({ width, height });
  });

  afterAll(async () =&gt; {
    await page.screenshot({path: myBlog});
    browser.close();
  });

  it(&quot;Should have a list of uls for features in Puppeteer&quot;, async () =&gt; {
    await page.goto(webpage);
    const textContent = await page.evaluate(() =&gt; document.querySelector('.markdown-body.entry-content blockquote p').textContent);
    expect(textContent).toEqual(&quot;Puppeteer is a Node library which provides a high-level API to control headless Chrome or Chromium over the DevTools Protocol. It can also be configured to use full (non-headless) Chrome or Chromium.&quot;);
  });
});
</code></pre>

<p>Notice that in this code snippet we are writing a test that launches puppeteer and then uses the Puppeteer api to navigate to Puppeteer github repository and web scrape the offical quote for Puppeteer.</p>

<p>The Puppeteer api is very intuitive to use as the code is almost self documenting.</p>

<p>Using async and await features makes writing this test very nice!!</p>

<h6 id="output-of-running-test">Output of running test</h6>

<p>In the scripts section of your package.json file and the following entry:</p>

<pre><code class="language-json">&quot;scripts&quot;: {
  &quot;test&quot;: &quot;jest&quot;
}
</code></pre>

<p>Now all you have to do is run <code>npm test</code> and the test will run and you will get output in your Terminal and or Command Shell in Windows.</p>

<figure>
    <img src="/media/puppeteer-console-log.png"/> 
</figure>


<h2 id="cypress-io">Cypress.io</h2>

<p>Next we will look at the <a href="https://docs.cypress.io/guides/overview/why-cypress.html#" target="_blank">Cypress.io Testing Library</a> which is a newer testing tool that has some exciting features.</p>

<p>Cypress also uses node.js and can be installed with npm</p>

<h4 id="advantages-of-cypress-io">Advantages of Cypress.io</h4>

<p><a href="https://docs.cypress.io/guides/overview/key-differences.html#Architecture" target="_blank">Key Differences in Cypress.io</a></p>

<blockquote>
<p>Most testing tools (like Selenium) operate by running outside of the browser and executing remote commands across the network. Cypress is the exact opposite. Cypress is executed in the same run loop as your application.</p>

<p>Behind Cypress is a Node.js server process. Cypress and the Node.js process constantly communicate, synchronize, and perform tasks on behalf of each other. Having access to both parts (front and back) gives us the ability to respond to your applicationâ€™s events in real time, while at the same time work outside of the browser for tasks that require a higher privilege.</p>

<p>Cypress also operates at the network layer by reading and altering web traffic on the fly. This enables Cypress to not only modify everything coming in and out of the browser, but also to change code that may interfere with its ability to automate the browser.</p>

<p>Cypress ultimately controls the entire automation process from top to bottom, which puts it in the unique position of being able to understand everything happening in and outside of the browser. This means Cypress is capable of delivering more consistent results than any other testing tool.</p>

<p>Because Cypress is installed locally on your machine, it can additionally tap into the operating system for automation tasks. This makes performing tasks such as taking screenshots, recording videos, general file system operations and network operations possible.</p>
</blockquote>

<h4 id="setup-cypress-io">Setup Cypress.io</h4>

<p>Installing <a href="https://docs.cypress.io/guides/getting-started/installing-cypress.html" target="_blank">Cypress.io</a> is easy as all you have to do is run <code>npm install --save-dev cypress</code></p>

<p>Once you have installed Cypress.io all you have to do is require it and then start writing your tests.</p>

<h4 id="cypress-io-usage-requirements">Cypress.io Usage Requirements</h4>

<p>Cypress is a desktop application that is installed on your computer.</p>

<p>The desktop application supports these operating systems:</p>

<ul>
<li><p>Mac OS 10.9+ (Mavericks+), only 64bit binaries are provided for macOS.</p></li>

<li><p>Linux Ubuntu 12.04+, Fedora 21, Debian 8</p></li>

<li><p>Windows 7+, only 32bit binaries are provided for Windows.</p></li>
</ul>

<h4 id="cypress-io-example">Cypress.io Example</h4>

<pre><code class="language-js">describe('My First Test', function() {
  it('Does not do much!', function() {
    expect(true).to.equal(true)
  })
})
</code></pre>

<p>This code snippet above has a mocha like syntax and running it is very easy</p>

<h6 id="running-cypress-tests">Running Cypress Tests</h6>

<p>Add the following entry into the scripts section of your package.json file:</p>

<pre><code class="language-json">&quot;scripts&quot;: {
  &quot;cypress:open&quot;: &quot;cypress open&quot;
}
</code></pre>

<p>Now all you have to do to run the test file is to execute the command like this:</p>

<p><code>npm run cypress:open</code> and this will open desktop application and run any of your tests</p>

<h4 id="writing-a-test-that-will-web-scrape-my-github-repository">Writing a Test that will Web Scrape my github repository</h4>

<p>Let us now write a test in Cypress.io that will Web Scrape my github repository called browser automation.</p>

<pre><code class="language-js">&quot;use strict&quot;;

const url = &quot;https://github.com/jbelmont/browser-automation&quot;

describe(&quot;Web Scraping&quot;, function() {
    it(&quot;Visits the browser-automation repository&quot;, function() {
        cy.visit(url);

        cy
        .get(&quot;.markdown-body.entry-content h1&quot;)
        .should(&quot;contain&quot;, &quot;browser-automation&quot;);
    });
});
</code></pre>

<p>Notice the conciseness in the syntax for Cypress you say you want to visit provided url and then use get to get the dom node and make your assertion.</p>

<p>The DOM Manipulation code that you have to write is abstracted away for you with the nice Cypress.io api.</p>

<h6 id="output-of-running-desktop-application-for-cypress">Output of Running Desktop Application for Cypress</h6>

<p>In the screenshot below we have a running Desktop application for Cypress.io which opened after we gave command <code>npm run cypress:open</code> in the terminal.</p>

<figure>
    <img src="/media/cypress-desktop-running.png"/> 
</figure>


<p>Notice that in the screenshot we have blog_spec.js at the top.</p>

<p>In order for your tests to run in Cypress.io you will need to add them into <code>cypress/integration</code> folder which is automatically created with examples when you first open Cypress.</p>

<p>While the desktop client is running it will watch for file changes and update in real time.</p>

<p>If we click the the entry <em>blog_spec.js</em> it will start running our tests in Cypress.io</p>

<figure>
    <img src="/media/cypress-test-running.png"/> 
</figure>


<p>Notice that the Cypress Desktop Application has our test results and visually shows us the web page that we are visiting.</p>

<h4 id="thoughts-on-cypress-io-and-puppeteer">Thoughts on Cypress.io and Puppeteer</h4>

<p>I believe that both Cypress.io and Puppeteer are great options to using Selenium. I would say that Cypress.io has many compelling features and the Desktop Client is a joy to use.</p>

<p>If you would like to look at the <a href="https://github.com/jbelmont/browser-automation" target="_blank">browser-automation repository go here</a></p>

<p>If you like this blog post then please follow me at <a href="https://github.com/jbelmont" target="_blank">jbelmont at Github</a></p>

    </div>
  </div>

</article>

<div class="container">
  <nav>
  <ul class="pager">
    
    <li class="previous"><a href="https://www.marcelbelmont.com/post/acceptance-testing/"><span
      aria-hidden="true">&larr;</span> Acceptance Testing</a></li>
    

    
    <li class="next"><a href="https://www.marcelbelmont.com/post/tips-and-tricks-with-curl-and-jq/">Tips and Tricks With Curl and Jq <span
      aria-hidden="true">&rarr;</span></a></li>
    
  </ul>
</nav>

</div>

<div class="article-container">
  
<section id="comments">
  <div id="disqus_thread">
    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "marcelbelmont-com" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </div>
</section>


</div>

<footer class="site-footer">
  <div class="container">
    <p class="powered-by">

      &copy; 2017 Jean-Marcel Belmont &middot; 

      Powered by the <a href="https://github.com/gcushen/hugo-academic" target="_blank">Academic
      theme</a> for <a href="http://gohugo.io" target="_blank">Hugo</a>.

      <span class="pull-right" aria-hidden="true">
        <a href="#" id="back_to_top">
          <span class="button_icon">
            <i class="fa fa-chevron-up fa-2x"></i>
          </span>
        </a>
      </span>

    </p>
  </div>
</footer>

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js" integrity="sha512-jGsMH83oKe9asCpkOVkBnUrDDTp8wl+adkB2D+//JtlxO4SrLoJdhbOysIFQJloQFD+C4Fl1rMsQZF76JjV0eQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.2/imagesloaded.pkgd.min.js" integrity="sha512-iHzEu7GbSc705hE2skyH6/AlTpOfBmkx7nUqTLGzPYR+C1tRaItbRlJ7hT/D3YQ9SV0fqLKzp4XY9wKulTBGTw==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.19.1/TweenMax.min.js" integrity="sha512-Z5heTz36xTemt1TbtbfXtTq5lMfYnOkXM2/eWcTTiLU01+Sw4ku1i7vScDc8fWhrP2abz9GQzgKH5NGBLoYlAw==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.19.1/plugins/ScrollToPlugin.min.js" integrity="sha512-CDeU7pRtkPX6XJtF/gcFWlEwyaX7mcAp5sO3VIu/ylsdR74wEw4wmBpD5yYTrmMAiAboi9thyBUr1vXRPA7t0Q==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha512-iztkobsvnjKfAtTNdHkGVjAYTrrtlC7mGp/54c40wowO7LhURYl3gVzzcEqGl/qKXQltJ2HwMrdLcNUdo+N/RQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
    
    <script src="/js/hugo-academic.js"></script>
    

    
    
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_CHTML" integrity="sha512-tOav5w1OjvsSJzePRtt2uQPFwBoHt1VZcUq8l8nm5284LEKE9FSJBQryzMBzHxY5P0zRdNqEcpLIRVYFNgu1jw==" crossorigin="anonymous"></script>
    
    

    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-1624619104728238",
        enable_page_level_ads: true
      });
    </script>

  </body>
</html>

